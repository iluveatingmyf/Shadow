# Home Assistant Provenance Instrumentation (HA-Provenance)

æœ¬é¡¹ç›®æä¾›äº†ä¸€å¥—é’ˆå¯¹ Home Assistant (HA) æ ¸å¿ƒæºç çš„æ’æ¡©æ–¹æ¡ˆï¼Œç”¨äºæ•è·å’Œè®°å½•æ™ºèƒ½å®¶å±…ç³»ç»Ÿä¸­çš„ **æº¯æºæ•°æ® (Provenance Data)**ã€‚é€šè¿‡è¯¥æ’æ¡©ï¼Œç³»ç»Ÿå¯ä»¥è‡ªåŠ¨è®°å½•è®¾å¤‡çŠ¶æ€å˜åŒ–ã€è‡ªåŠ¨åŒ–æ‰§è¡Œåºåˆ—ä»¥åŠéè‡ªåŠ¨åŒ–çš„æ‰‹åŠ¨å¹²é¢„ï¼Œå¹¶å°†å…¶ä¿å­˜ä¸ºå¸¦æ—¶é—´æˆ³çš„ç»“æ„åŒ– JSON æ—¥å¿—ã€‚

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½
* **ä¼šè¯åŒ–æ—¥å¿—**ï¼šæ¯æ¬¡ HA å¯åŠ¨éƒ½ä¼šå¼€å¯å…¨æ–°çš„æº¯æºåºåˆ—ï¼Œå…³é—­æ—¶è‡ªåŠ¨æŒä¹…åŒ–ã€‚
* **å› æœæº¯æº**ï¼šè®°å½•çŠ¶æ€å˜åŒ–èƒŒåçš„è§¦å‘é€»è¾‘ï¼ˆå¦‚ï¼šå“ªä¸ªè‡ªåŠ¨åŒ–å¯¼è‡´äº†ç¯å…‰å¼€å¯ï¼‰ã€‚
* **è‡ªåŠ¨åŒ–æå–**ï¼šè‡ªåŠ¨è§£æè„šæœ¬å’Œè‡ªåŠ¨åŒ–ä¸­çš„ `If-Then`, `Choose`, `Repeat` ç­‰å¤æ‚åµŒå¥—é€»è¾‘ã€‚
* **è½»é‡åŒ–æ’æ¡©**ï¼šé‡‡ç”¨ Patch è¡¥ä¸æ–¹å¼ï¼Œå¯¹ HA åŸç”Ÿé€»è¾‘ä¾µå…¥æ€§æå°ã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„
* `scripts/provenance.py`: æ ¸å¿ƒé€»è¾‘æ¨¡å—ï¼ŒåŒ…å«äº‹ä»¶è®°å½•ã€æ—¥å¿—ä¿å­˜å’Œè·¯å¾„ç®¡ç†ã€‚
* `patches/`: å­˜æ”¾é’ˆå¯¹ä¸åŒ HA ç‰ˆæœ¬çš„è¡¥ä¸æ–‡ä»¶ï¼ˆå¦‚ `provenance_2024.1.5.patch`ï¼‰ã€‚
* `install.sh`: è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‰ææ¡ä»¶
* Home Assistant ç‰ˆæœ¬: `2024.1.5` (å¦‚ç‰ˆæœ¬ä¸åŒï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨è°ƒæ•´ Patch)
* è¿è¡Œç¯å¢ƒ: æ ‘è“æ´¾ (Raspberry Pi) æˆ–å…¶ä»– Linux ç¯å¢ƒ

### 2. éƒ¨ç½²æ­¥éª¤
å…‹éš†ä»“åº“å¹¶è¿è¡Œå®‰è£…è„šæœ¬ï¼š
```bash
git clone [https://github.com/your-username/ha-provenance.git](https://github.com/your-username/ha-provenance.git)
cd ha-provenance
chmod +x install.sh
./install.sh
```

## ğŸ“Š æ—¥å¿—è¾“å‡º
æº¯æºæ—¥å¿—å°†å­˜å‚¨åœ¨ï¼š `/home/homeassistant/.homeassistant/provenance_logs/provenance_log_YYYY-MM-DD-HH-MM-SS.json`

æ—¥å¿—ç¤ºä¾‹ï¼š

```JSON
{
  "event_id": 12,
  "event_type": "Entity",
  "device": "light.living_room",
  "action": "turn_on",
  "source": 5, 
  "description": "State changed to on",
  "timestamp": "2026-02-12 21:24:32"
}
```